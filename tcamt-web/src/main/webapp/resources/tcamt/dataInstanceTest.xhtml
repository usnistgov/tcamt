<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:tcamt="http://java.sun.com/jsf/composite/tcamt"
	xmlns:composite="http://java.sun.com/jsf/composite">
<composite:interface>
</composite:interface>

<composite:implementation>
	<h:form id="DataInstanceTestForm" onkeypress="if (event.keyCode == 13) { return false; }">
		<p:accordionPanel widgetVar="DataInstanceTestPanel" activeIndex="#{sessionBeanTCAMT.ditActiveIndex}">
			<p:tab id="DataInstanceTestPanel_List" title="Data Instance Test Plan List">
				<table width="100%">
					<tr>
						<td align="right">
							<p:commandButton
								update=":#{p:component('DataInstanceTestForm')}"  
								value="Create New TestPlan" icon="ui-icon-plus"
								actionListener="#{dataInstanceTestPlanRequestBean.createTestPlan}" />
						</td>
					</tr>
				</table>

				<p:dataTable var="testplan" value="#{dataInstanceTestPlanRequestBean.testPlans}">
					<p:column headerText="Name">
						<h:outputText value="#{testplan.name}" />
					</p:column>

					<p:column headerText="Description">
						<h:outputText value="#{testplan.description}" />
					</p:column>

					<p:column headerText="Version">
						<h:outputText value="#{testplan.version}" />
					</p:column>

					<p:column headerText="Action">
						<p:commandButton value="Edit"
    									actionListener="#{dataInstanceTestPlanRequestBean.selectTestPlan}"
										update=":#{p:component('DataInstanceTestForm')}" icon="ui-icon-search"
										title="Select Test Plan">
								<f:attribute name="testplan" value="#{testplan}" />
						</p:commandButton>
						<p:commandButton value="Export" ajax="false" actionListener="#{dataInstanceTestPlanRequestBean.downloadResourceBundleForTestPlan(testplan)}" icon="ui-icon-print">
							<p:fileDownload value="#{dataInstanceTestPlanRequestBean.zipResourceBundleFile}" />
						</p:commandButton>
						<p:commandButton value="Delete"
    									actionListener="#{dataInstanceTestPlanRequestBean.deleteTestPlan}"
										update=":#{p:component('DataInstanceTestForm')}" icon="ui-icon-close"
										title="Delete Test Plan">
								<f:attribute name="testplan" value="#{testplan}" />
						</p:commandButton>
					</p:column>
				</p:dataTable>
			</p:tab>
			<p:tab title="Data Instance Test Plan DashBoard">
				<p:layout  style="min-width:400px;min-height:700px;">
					<p:layoutUnit position="north" style="border: 0;">
						<table width="100%">
							<tr>
								<td align="right">
									<p:commandButton value="Save Test Plan"
    									actionListener="#{dataInstanceTestPlanRequestBean.saveTestPlan}"
										update=":#{p:component('DataInstanceTestForm')}" icon="ui-icon-disk"
										title="Save Test Plan"/>
								</td>
							</tr>
						</table>
    				</p:layoutUnit>
   		 			<p:layoutUnit position="west" resizable="true" size="300" minSize="40" maxSize="500" style="border: 0;">
   		 				<p:tree id="testplanTree" value="#{dataInstanceTestPlanRequestBean.testplanRoot}" var="node" selectionMode="single" selection="#{dataInstanceTestPlanRequestBean.selectedNode}" dynamic="true" style="border-width:0;">                    
        					<p:ajax event="select" update=":#{p:component('DataInstanceTestForm')}" listener="#{dataInstanceTestPlanRequestBean.onNodeSelect}" />
        					
        					<p:treeNode expandedIcon="ui-icon-folder-open" collapsedIcon="ui-icon-folder-collapsed">
            					<h:outputText value="#{node.name}"/>
        					</p:treeNode>
        					<p:treeNode type="plan" icon="ui-icon-image">
            					<h:outputText value="#{node.name}" />
        					</p:treeNode>
        					<p:treeNode type="group" icon="ui-icon-image">
            					<h:outputText value="#{node.name}" />
        					</p:treeNode>
        					<p:treeNode type="case" icon="ui-icon-image">
            					<h:outputText value="#{node.name}" />
        					</p:treeNode>
    					</p:tree>
    					<p:contextMenu for="testplanTree" nodeType="plan">
        					<p:menuitem value="Add TestCaseGroup" update=":#{p:component('DataInstanceTestForm')}" actionListener="#{dataInstanceTestPlanRequestBean.addTestCaseGroup}" icon="ui-icon-plus" />
        					<p:menuitem value="Add TestCase" update=":#{p:component('DataInstanceTestForm')}" actionListener="#{dataInstanceTestPlanRequestBean.addTestCase}" icon="ui-icon-plus"/>
    					</p:contextMenu>
    					<p:contextMenu for="testplanTree" nodeType="group">
        					<p:menuitem value="Add TestCase" update=":#{p:component('DataInstanceTestForm')}" actionListener="#{dataInstanceTestPlanRequestBean.addTestCase}" icon="ui-icon-plus"/>
        					<p:menuitem value="Delete TestCaseGroup" update=":#{p:component('DataInstanceTestForm')}" actionListener="#{dataInstanceTestPlanRequestBean.deleteTestCaseGroup}" icon="ui-icon-plus"/>
    					</p:contextMenu>
    					<p:contextMenu for="testplanTree" nodeType="case">
        					<p:menuitem value="Delete TestCase" update=":#{p:component('DataInstanceTestForm')}" actionListener="#{dataInstanceTestPlanRequestBean.deleteTestCase}" icon="ui-icon-plus"/>
    					</p:contextMenu>
    				</p:layoutUnit>
    				<p:layoutUnit id="dashboard" position="center" style="border: 0;">
        				<p:accordionPanel rendered="#{dataInstanceTestPlanRequestBean.selectedTestCase != null}">
        					<p:tab title="Test Case MetaData">
            					<h:panelGrid columns="2" cellpadding="10">
                					<h:outputText value="Name: " />
                					<p:inplace editor="true" >
                						<p:inputText style="width:500px;" value="#{dataInstanceTestPlanRequestBean.selectedTestCase.name}" />
                						<p:ajax event="save" update=":#{p:component('testplanTree')}" />
                					</p:inplace>
                					<h:outputText value="Description: " />
                					<p:inplace editor="true" >
                						<p:inputText style="width:500px;" value="#{dataInstanceTestPlanRequestBean.selectedTestCase.description}" />
                						<p:ajax event="save" update=":#{p:component('testplanTree')}" />
                					</p:inplace>
                					<h:outputText value="Version: " />
                					<h:outputText style="width:500px;" value="#{dataInstanceTestPlanRequestBean.selectedTestCase.version}" />
            					</h:panelGrid>
        					</p:tab>
        					<p:tab title="Test Case Story">
            					<h:panelGrid columns="2" cellpadding="10">
                					<h:outputText value="Test Story Desc: " />
                					<p:inplace editor="true" >
                						<p:editor widgetVar="testStoryDescWidget" value="#{dataInstanceTestPlanRequestBean.selectedTestCase.testCaseStory.teststorydesc}" style="width:100%;" />
                						<p:ajax event="save" update=":#{p:component('testplanTree')}" />
        							</p:inplace>
        							
        							<h:outputText value="Comments: " />
                					<p:inplace editor="true" >
                						<p:editor widgetVar="testStoryCommentsWidget" value="#{dataInstanceTestPlanRequestBean.selectedTestCase.testCaseStory.comments}" style="width:100%;" />
                						<p:ajax event="save" update=":#{p:component('testplanTree')}" />
                					</p:inplace>
                					
                					<h:outputText value="Pre-Condition: " />
                					<p:inplace editor="true" >
                						<p:editor widgetVar="testStoryPreConditionWidget" value="#{dataInstanceTestPlanRequestBean.selectedTestCase.testCaseStory.preCondition}" style="width:100%;" />
                						<p:ajax event="save" update=":#{p:component('testplanTree')}" />
                					</p:inplace>
                					
                					<h:outputText value="Post-Condition: " />
                					<p:inplace editor="true" >
                						<p:editor widgetVar="testStoryPostConditionWidget" value="#{dataInstanceTestPlanRequestBean.selectedTestCase.testCaseStory.postCondition}" style="width:100%;" />
                						<p:ajax event="save" update=":#{p:component('testplanTree')}" />
                					</p:inplace>
                					
                					<h:outputText value="Test Objectives: " />
                					<p:inplace editor="true" >
                						<p:editor widgetVar="testStoryTestObjectivesWidget" value="#{dataInstanceTestPlanRequestBean.selectedTestCase.testCaseStory.testObjectives}" style="width:100%;" />
                						<p:ajax event="save" update=":#{p:component('testplanTree')}" />
                					</p:inplace>
                					
                					<h:outputText value="Evaluation Criteria: " />
                					<p:inplace editor="true" >
                						<p:editor widgetVar="testStoryEvaluationCriteriaWidget" value="#{dataInstanceTestPlanRequestBean.selectedTestCase.testCaseStory.evaluationCriteria}" style="width:100%;" />
                						<p:ajax event="save" update=":#{p:component('testplanTree')}" />
                					</p:inplace>
                					
                					<h:outputText value="Notes: " />
                					<p:inplace editor="true" >
                						<p:editor widgetVar="testStoryNotesWidget" value="#{dataInstanceTestPlanRequestBean.selectedTestCase.testCaseStory.notes}" style="width:100%;" />
                						<p:ajax event="save" update=":#{p:component('testplanTree')}" />
                					</p:inplace>
            					</h:panelGrid>
        					</p:tab>
        					<p:tab id="dTestStepDefinition" title="Test Step Definition">
								<h:panelGrid columns="1" cellpadding="10" style="width:100%;">
									<table width="100%">
										<tr>
											<td align="right">
												<p:commandButton
												value="Create TestStep" icon="ui-icon-plus"
												update=":#{p:component('dCreateTestStepForm')}"
												actionListener="#{dataInstanceTestPlanRequestBean.createTestStep}"
												oncomplete="PF('dCreateTestStep').show();" />
											</td>
										</tr>
									</table>
        							<p:dataTable id="dTestStepList" var="teststep" value="#{dataInstanceTestPlanRequestBean.selectedTestCase.teststeps}">
										<p:column headerText="Name">
											<h:outputText value="#{teststep.name}" />
										</p:column>

										<p:column headerText="Description">
											<h:outputText value="#{teststep.description}" />
										</p:column>
									
										<p:column headerText="Message">
											<h:outputText value="#{teststep.message.name}(#{teststep.message.version})" />
										</p:column>

										<p:column headerText="Action">
											<p:commandButton value="Edit" actionListener="#{dataInstanceTestPlanRequestBean.selectTestStep}"
												update=":#{p:component('DataInstanceTestForm')}" icon="ui-icon-search" title="Select Test Step">
												<f:attribute name="teststep" value="#{teststep}" />
											</p:commandButton>
											<p:commandButton value="Delete" actionListener="#{dataInstanceTestPlanRequestBean.deleteTestStep}"
												update=":#{p:component('DataInstanceTestForm')}" icon="ui-icon-close" title="Delete Test Step">
												<f:attribute name="teststep" value="#{teststep}" />
											</p:commandButton>
										</p:column>
									</p:dataTable>
									<p:accordionPanel id="dInstancePanel" widgetVar="dMessageInstancePanel" rendered="#{dataInstanceTestPlanRequestBean.selectedTestStep != null}" activeIndex="#{dataInstanceTestPlanRequestBean.activeIndexOfMessageInstancePanel}" style="width:100%;">
										<p:tab title="TestStep Story">
            								<h:panelGrid columns="2" cellpadding="10">
                								<h:outputText value="Test Story Desc: " />
                								<p:inplace editor="true" >
                									<p:editor widgetVar="testStepStoryDescWidget" value="#{dataInstanceTestPlanRequestBean.selectedTestStep.testStepStory.teststorydesc}" style="width:100%;" />
                									<p:ajax event="save" update=":#{p:component('iTestplanTree')}" />
        										</p:inplace>
        							
        										<h:outputText value="Comments: " />
                								<p:inplace editor="true" >
                									<p:editor widgetVar="testStepStoryCommentsWidget" value="#{dataInstanceTestPlanRequestBean.selectedTestStep.testStepStory.comments}" style="width:100%;" />
                									<p:ajax event="save" update=":#{p:component('iTestplanTree')}" />
                								</p:inplace>
                					
                								<h:outputText value="Pre-Condition: " />
                								<p:inplace editor="true" >
                									<p:editor widgetVar="testStepStoryPreConditionWidget" value="#{dataInstanceTestPlanRequestBean.selectedTestStep.testStepStory.preCondition}" style="width:100%;" />
                									<p:ajax event="save" update=":#{p:component('iTestplanTree')}" />
                								</p:inplace>
                					
                								<h:outputText value="Post-Condition: " />
                								<p:inplace editor="true" >
                									<p:editor widgetVar="testStepStoryPostConditionWidget" value="#{dataInstanceTestPlanRequestBean.selectedTestStep.testStepStory.postCondition}" style="width:100%;" />
                									<p:ajax event="save" update=":#{p:component('iTestplanTree')}" />
                								</p:inplace>
                					
                								<h:outputText value="Test Objectives: " />
                								<p:inplace editor="true" >
                									<p:editor widgetVar="testStepStoryTestObjectivesWidget" value="#{dataInstanceTestPlanRequestBean.selectedTestStep.testStepStory.testObjectives}" style="width:100%;" />
                									<p:ajax event="save" update=":#{p:component('iTestplanTree')}" />
                								</p:inplace>
                					
                								<h:outputText value="Evaluation Criteria: " />
                								<p:inplace editor="true" >
                									<p:editor widgetVar="testStepStoryEvaluationCriteriaWidget" value="#{dataInstanceTestPlanRequestBean.selectedTestStep.testStepStory.evaluationCriteria}" style="width:100%;" />
                									<p:ajax event="save" update=":#{p:component('testplanTree')}" />
                								</p:inplace>
                					
                								<h:outputText value="Notes: " />
                								<p:inplace editor="true" >
                									<p:editor widgetVar="testStepStoryNotesWidget" value="#{dataInstanceTestPlanRequestBean.selectedTestStep.testStepStory.notes}" style="width:100%;" />
                									<p:ajax event="save" update=":#{p:component('iTestplanTree')}" />
                								</p:inplace>
            								</h:panelGrid>
        								</p:tab>
										<p:tab title="HL7 Message Tree">
											<p:scrollPanel style="width:100%;" mode="native">
												<tcamt:messageConstructor bean="#{dataInstanceTestPlanRequestBean}" panelId=":#{p:component('dInstancePanel')}"/>
											</p:scrollPanel>
										</p:tab>
										<p:tab title="HL7 Encoded Message">
											<p:scrollPanel style="width:100%;" mode="native">
												<tcamt:sampleMessage hl7EndcodedMessage="#{dataInstanceTestPlanRequestBean.selectedTestStep.message.hl7EndcodedMessage}" bean="#{dataInstanceTestPlanRequestBean}" panelId=":#{p:component('dInstancePanel')}"/>
											</p:scrollPanel>
										</p:tab>
										<p:tab title="Segments List">
											<p:scrollPanel style="width:100%;" mode="native">
												<tcamt:segmentList bean="#{dataInstanceTestPlanRequestBean}" panelId=":#{p:component('dInstancePanel')}"/>
											</p:scrollPanel>
										</p:tab>
										<p:tab title="TestData of Selected Segment">
											<p:scrollPanel style="width:100%;" mode="native">
												<tcamt:testDataOfSegment bean="#{dataInstanceTestPlanRequestBean}" panelId=":#{p:component('dInstancePanel')}"/>
											</p:scrollPanel>
										</p:tab>
										<p:tab title="List Contraints">
											<p:scrollPanel style="width:100%;" mode="native">
												<tcamt:constraintsTable bean="#{dataInstanceTestPlanRequestBean}" panelId=":#{p:component('dInstancePanel')}" constraints="#{dataInstanceTestPlanRequestBean.selectedTestStep.message.tcamtConstraints}" />
											</p:scrollPanel>
										</p:tab>
									</p:accordionPanel>								
            					</h:panelGrid>
        					</p:tab>
    					</p:accordionPanel>
    					<p:accordionPanel rendered="#{dataInstanceTestPlanRequestBean.selectedTestCaseGroup != null}">
        					<p:tab title="Test Case Group MetaData">
            					<h:panelGrid columns="2" cellpadding="10">
                					<h:outputText value="Name: " />
                					<p:inplace editor="true" >
            							<p:inputText value="#{dataInstanceTestPlanRequestBean.selectedTestCaseGroup.name}" required="true" label="text" />
            							<p:ajax event="save" update=":#{p:component('testplanTree')}" />
        							</p:inplace>
                					<h:outputText value="Description: " />
                					<p:inplace editor="true" >
                						<p:inputText style="width:500px;" value="#{dataInstanceTestPlanRequestBean.selectedTestCaseGroup.description}" />
                						<p:ajax event="save" update=":#{p:component('testplanTree')}" />
        							</p:inplace>
                					<h:outputText value="Version: " />
                					<h:outputText style="width:500px;" value="#{dataInstanceTestPlanRequestBean.selectedTestCaseGroup.version}" />
            					</h:panelGrid>
        					</p:tab>
    					</p:accordionPanel>
    					<p:accordionPanel rendered="#{dataInstanceTestPlanRequestBean.selectedTestCaseGroup == null and dataInstanceTestPlanRequestBean.selectedTestCase == null}">
        					<p:tab title="Test Plan MetaData">
            					<h:panelGrid columns="2" cellpadding="10">
                					<h:outputText value="Name: " ></h:outputText>
                					<p:inplace editor="true" >
                						<p:inputText style="width:500px;" value="#{dataInstanceTestPlanRequestBean.selectedTestPlan.name}" />
                						<p:ajax event="save" update=":#{p:component('testplanTree')}" />
        							</p:inplace>
                					<h:outputText value="Description: " />
                					<p:inplace editor="true" >
                						<p:inputText style="width:500px;" value="#{dataInstanceTestPlanRequestBean.selectedTestPlan.description}" />
                						<p:ajax event="save" update=":#{p:component('testplanTree')}" />
        							</p:inplace>
                					<h:outputText value="Version: " />
                					<h:outputText style="width:500px;" value="#{dataInstanceTestPlanRequestBean.selectedTestPlan.version}" />
                					<h:outputText value="Author: " />
                					<h:outputText style="width:500px;" value="#{dataInstanceTestPlanRequestBean.selectedTestPlan.author.userId}" />
            					</h:panelGrid>
        					</p:tab>
    					</p:accordionPanel>
    				</p:layoutUnit>
				</p:layout>
			</p:tab>

		</p:accordionPanel>
	</h:form>
	<h:form id="dCreateTestStepForm" onkeypress="if (event.keyCode == 13) { return false; }">
		<p:dialog id="dCreateTestStepDialog" header="Create TestStep" widgetVar="dCreateTestStep">
			<h:panelGrid columns="2" cellpadding="5">
				<h:outputText value="Name: " />
				<p:inputText value="#{dataInstanceTestPlanRequestBean.newTestStep.name}" />

				<h:outputText value="Description: " />
				<p:inputText value="#{dataInstanceTestPlanRequestBean.newTestStep.description}"/>


				<h:outputText value="Message: " />
				<p:selectOneMenu value="#{dataInstanceTestPlanRequestBean.messageId}" effect="fade">
					<f:selectItem itemLabel="Select One" itemValue="" />
					<f:selectItems value="#{messageRequestBean.messages}" var="message" itemLabel="#{message.name}(#{message.version})" itemValue="#{message.id}" />
				</p:selectOneMenu>

			</h:panelGrid>
			<table width="100%">
				<tr>
					<td align="right">
						<p:commandButton value="Create" icon="ui-icon-plus" update=":#{p:component('DataInstanceTestForm')}"
							actionListener="#{dataInstanceTestPlanRequestBean.addTestStep}" onclick="PF('dCreateTestStep').hide();" />
					</td>
				</tr>
			</table>
		</p:dialog>
	</h:form>
</composite:implementation>

</html>