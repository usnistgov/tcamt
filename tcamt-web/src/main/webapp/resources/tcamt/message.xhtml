<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:tcamt="http://java.sun.com/jsf/composite/tcamt">

<composite:interface>
</composite:interface>

<composite:implementation>
	<h:form id="messageForm">
		<p:growl id="growl_Message" showDetail="true" sticky="true" />  
		<p:remoteCommand name="ctrls" update="messageForm" actionListener="#{messageRequestBean.saveMessage}" />
		<p:accordionPanel widgetVar="MessageLibPanel" activeIndex="#{sessionBeanTCAMT.mActiveIndex}">
			<p:tab title="Message List">
				<table width="100%">
					<tr>
						<td align="right"><p:commandButton value="Create New Message"
								icon="ui-icon-plus"
								update=":#{p:component('createMessageForm')}"
								actionListener="#{messageRequestBean.createMessage}"
								oncomplete="PF('createMessage').show();" /></td>
					</tr>
				</table>
				<p:dataTable id="messageList" var="message"
					value="#{messageRequestBean.messages}">
					<p:column headerText="Name">
						<h:outputText value="#{message.name}" />
					</p:column>

					<p:column headerText="Description">
						<h:outputText value="#{message.description}" />
					</p:column>
					
					<p:column headerText="Last Updated">
						<h:outputText value="#{message.lastUpdateDate}" />
					</p:column>

					<p:column headerText="Version">
						<h:outputText value="#{message.version}" />
					</p:column>

					<p:column headerText="Action">
						<p:commandButton value="Select Message"
							icon="ui-icon-search"
							update=":#{p:component('messageForm')}"
							actionListener="#{messageRequestBean.selectEditMessage}">
							<f:attribute name="message" value="#{message}" />
						</p:commandButton>
						
						<p:commandButton value="Cloning"
							actionListener="#{messageRequestBean.cloneMessage}"
							update=":#{p:component('messageForm')}" icon="ui-icon-plus"
							title="Cloning">
							<f:attribute name="message" value="#{message}" />
						</p:commandButton>
						
						<p:commandButton
							value="Sharing" icon="ui-icon-transfer-e-w"
							update=":#{p:component('shareMessageForm')}"
							actionListener="#{messageRequestBean.selectEditMessage}"
							oncomplete="PF('shareMessage').show();" >
							<f:attribute name="message" value="#{message}" />
						</p:commandButton>

						<p:commandButton value="Del"
							actionListener="#{messageRequestBean.delMessage}"
							update=":#{p:component('messageForm')}" icon="ui-icon-close"
							title="Del">
							<f:attribute name="message" value="#{message}" />
						</p:commandButton>
					</p:column>
				</p:dataTable>
			</p:tab>
			<p:tab title="Selected Message Definition">
				<p:fieldset legend="Message Definition" toggleable="true">
					<p:scrollPanel style="width:100%;height:200px" mode="native">
						<p:treeTable id="messageProfileTreeTable"
							value="#{messageRequestBean.messageTreeRoot}"
							var="model" resizableColumns="true"
							selection="#{messageRequestBean.selectedNode}"
							selectionMode="single">
							<p:ajax event="select"
								listener="#{messageRequestBean.onNodeSelect}"
								update=":#{p:component('segmentTreeTable')}" />
							<p:column headerText="Location">
								<h:outputText value="#{model.path}" style="width:50%;" />
							</p:column>
							<p:column headerText="Name" style="width:20%;">
								<h:outputText value="#{model.name}" />
							</p:column>
							<p:column headerText="Usage"
								style="width:10%; text-align: center;">
								<h:outputText value="#{model.node.usage}" />
							</p:column>
							<p:column headerText="Cardinality"
								style="width:20%; text-align: center;">
								<h:outputText value="[#{model.node.min} ~ " />
								<h:outputText value="#{model.node.max}]" />
							</p:column>
						</p:treeTable>
					</p:scrollPanel>
				</p:fieldset>
				<p:fieldset legend="Segment Definition (Selected)" toggleable="true">
					<p:scrollPanel style="width:100%;height:400px" mode="native">
						<p:treeTable id="segmentTreeTable"
							value="#{messageRequestBean.selectedSegmentTreeRoot}"
							var="model" resizableColumns="true">
							<p:column headerText="Location">
								<h:outputText value="#{model.path}" style="width:15%;" />
							</p:column>
							<p:column headerText="Name" style="width:20%;">
								<h:outputText value="#{model.name}" />
							</p:column>
							<p:column headerText="DT" style="width:8%; text-align: center;">
								<h:outputText value="#{model.node.datatype.name}" />
							</p:column>
							<p:column headerText="Cardinality"
								style="width:8%; text-align: center;">
								<h:outputText
									rendered="#{model.node.getClass().getSimpleName() == 'Field'}"
									value="[#{model.node.min} ~ " />
								<h:outputText
									rendered="#{model.node.getClass().getSimpleName() == 'Field'}"
									value="#{model.node.max}]" />
							</p:column>

							<p:column headerText="Usage"
								style="width:8%; text-align: center;">
								<h:outputText value="#{model.node.usage}" />
							</p:column>

							<p:column headerText="Length"
								style="width:8%; text-align: center;">
								<h:outputText rendered="#{model.isLeafNode()}"
									value="[#{model.node.minLength} ~ " />
								<h:outputText rendered="#{model.isLeafNode()}"
									value="#{model.node.maxLength}]" />
							</p:column>

<!-- 							<p:column headerText="Data" style="width:7%; text-align: center;">
								<h:outputText rendered="#{model.isLeafNode()}"
									value="#{model.data}" />
							</p:column>
							<p:column headerText="Conf Statement"
								style="width:8%; text-align: center;">
								<p:commandButton icon="ui-icon-circle-zoomin" process="@this"
									immediate="true"
									rendered="#{!empty model.node.conformanceStatementList}"
									value="#{model.node.conformanceStatementList.size()}">
								</p:commandButton>
							</p:column>

							<p:column headerText="Predicate"
								style="width:8%; text-align: center;">
								<p:commandButton rendered="#{model.node.predicate != null}"
									icon="ui-icon-circle-zoomin" process="@this" immediate="true">
								</p:commandButton>
							</p:column>

							<p:column headerText="Value Set"
								style="width:10%; text-align: center;">
								<p:commandButton icon="ui-icon-circle-zoomin" process="@this"
									immediate="true" rendered="#{model.node.codeTable != null}"
									value="#{model.node.codeTable.name}">
								</p:commandButton>
							</p:column> -->

						</p:treeTable>
					</p:scrollPanel>
				</p:fieldset>
<!-- 				<p:fieldset legend="Conformance Statements" toggleable="true"
					collapsed="false">
					<p:scrollPanel style="width:100%;height:222px" mode="native">
						<p:dataTable id="messageProfileConformanceStatement" var="cs"
							value="#{messageRequestBean.editMessage.listCSs}"
							paginator="true" rows="5"
							paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
							rowsPerPageTemplate="5,10,15,100">
							<p:column headerText="Name">
								<h:outputText value="#{cs.name}" />
							</p:column>
							<p:column headerText="Path">
								<h:outputText value="#{cs.statementDetails.path}" />
							</p:column>
							<p:column headerText="Description">
								<h:outputText value="#{cs.description}" />
							</p:column>
						</p:dataTable>
					</p:scrollPanel>
				</p:fieldset>
				<p:fieldset legend="Conditional Predicates" toggleable="true"
					collapsed="false">
					<p:scrollPanel style="width:100%;height:222px" mode="native">
						<p:dataTable id="messageProfileConditionalPredicate" var="cp"
							value="#{messageRequestBean.editMessage.listCPs}"
							paginator="true" rows="5"
							paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
							rowsPerPageTemplate="5,10,15,100">
							<p:column headerText="Path">
								<h:outputText value="#{cp.predicateDetails.path}" />
							</p:column>
							<p:column headerText="Condition">
								<h:outputText value="#{cp.description}" />
							</p:column>
							<p:column headerText="True Usage">
								<h:outputText value="#{cp.trueUsage}" />
							</p:column>
							<p:column headerText="False Usage">
								<h:outputText value="#{cp.falseUsage}" />
							</p:column>
						</p:dataTable>
					</p:scrollPanel>
				</p:fieldset> -->
			</p:tab>
			<p:tab title="Selected Message Data">
				<table width="100%">
					<tr>
						<td align="right">
							<p:commandButton value="Update Profile" icon="ui-icon-pencil"
								update=":#{p:component('editMessageForm')}"
								oncomplete="PF('editMessage').show();">
							</p:commandButton>
							<p:commandButton value="Save Message"
								icon="ui-icon-disk"
								update=":#{p:component('messageForm')}"
								actionListener="#{messageRequestBean.saveMessage}"/>
						</td>
					</tr>
				</table>
				<h:panelGrid id="editMessagePanel" columns="2" cellpadding="5">
					<h:outputText value="Name: " />
					<p:inputText value="#{messageRequestBean.editMessage.name}" />
					<h:outputText value="Description: " />
					<p:inputText value="#{messageRequestBean.editMessage.description}" />
				</h:panelGrid>
				<p:accordionPanel id="mInstancePanel" widgetVar="MessageInstancePanel" activeIndex="#{messageRequestBean.activeIndexOfMessageInstancePanel}">
					<p:tab title="HL7 Message Tree">
						<tcamt:messageConstructor bean="#{messageRequestBean}" panelId=":#{p:component('mInstancePanel')}"/>
					</p:tab>
					<p:tab title="HL7 Encoded Message">
						<tcamt:sampleMessage hl7EndcodedMessage="#{messageRequestBean.editMessage.hl7EndcodedMessage}" bean="#{messageRequestBean}" panelId=":#{p:component('mInstancePanel')}"/>
					</p:tab>
					<p:tab title="Segments List">
						<tcamt:segmentList bean="#{messageRequestBean}" panelId=":#{p:component('mInstancePanel')}"/>
					</p:tab>
					<p:tab title="TestData of Selected Segment">
						<tcamt:testDataOfSegment bean="#{messageRequestBean}" panelId=":#{p:component('mInstancePanel')}"/>
					</p:tab>
					<p:tab title="STD XML Encoded Message">
						<tcamt:hl7XMLMessage xmlEncodedMessage="#{messageRequestBean.editMessage.xmlEncodedSTDMessage}"/>
					</p:tab>
					<p:tab title="NIST XML Encoded Message">
						<tcamt:hl7XMLMessage xmlEncodedMessage="#{messageRequestBean.editMessage.xmlEncodedNISTMessage}"/>
					</p:tab>
					<p:tab title="List Contraints">
						<tcamt:constraintsTable bean="#{messageRequestBean}" panelId=":#{p:component('mInstancePanel')}" />
					</p:tab>
				</p:accordionPanel>
			</p:tab>
		</p:accordionPanel>
	</h:form>
	
	<h:form id="createMessageForm">
		<p:dialog id="createMessageDialog" header="Create Message"
			widgetVar="createMessage">
			<h:panelGrid id="createMessagePanel1" columns="2" cellpadding="5">
				<h:outputText value="Name: " />
				<p:inputText value="#{messageRequestBean.newMessage.name}"/>
				<h:outputText value="Description: " />
				<p:inputText value="#{messageRequestBean.newMessage.description}"/>
				<h:outputText value="Message Profile: " />
				<h:panelGrid id="createMessagePanel2" columns="1" cellpadding="0">
					<p:fileUpload
						rendered="#{messageRequestBean.newMessage.profile == null}"
						fileUploadListener="#{messageRequestBean.uploadProfile}"
						update=":#{p:component('createMessagePanel2')}"
						mode="advanced"
						auto="true" sizeLimit="10000000" allowTypes="/(\.|\/)(xml)$/" />
					<h:outputText
						rendered="#{messageRequestBean.newMessage.profile != null}"
						value="Message Profile Uploaded" />
				</h:panelGrid>
				<h:outputText value="Constraints: " />
				<h:panelGrid id="createMessagePanel3" columns="1" cellpadding="0">
					<p:fileUpload
						rendered="#{messageRequestBean.newMessage.constraints == null}"
						fileUploadListener="#{messageRequestBean.uploadConstraints}"
						update=":#{p:component('createMessagePanel3')}"
						mode="advanced"
						auto="true" sizeLimit="10000000" allowTypes="/(\.|\/)(xml)$/" />
					<h:outputText
						rendered="#{messageRequestBean.newMessage.constraints != null}"
						value="Constraints Uploaded" />
				</h:panelGrid>
				<h:outputText value="ValueSet Lib: " />
				<h:panelGrid id="createMessagePanel4" columns="1" cellpadding="0">
					<p:fileUpload
						rendered="#{messageRequestBean.newMessage.valueSet == null}"
						fileUploadListener="#{messageRequestBean.uploadValueSet}"
						update=":#{p:component('createMessagePanel4')}"
						mode="advanced"
						auto="true" sizeLimit="10000000" allowTypes="/(\.|\/)(xml)$/" />
					<h:outputText
						rendered="#{messageRequestBean.newMessage.valueSet != null}"
						value="ValueSet Library Uploaded" />
				</h:panelGrid>
			</h:panelGrid>
			<table width="100%">
				<tr>
					<td align="right"><p:commandButton value="Create"
							icon="ui-icon-plus" update=":#{p:component('messageForm')}"
							actionListener="#{messageRequestBean.addMessage}"
							onclick="PF('createMessage').hide();" /></td>
				</tr>
			</table>
		</p:dialog>
	</h:form>
	
	<h:form id="shareMessageForm">
		<p:dialog id="shareMessageDialog" header="Share message"
			widgetVar="shareMessage">
			<h:panelGrid id="shareMessagePanel" columns="2" cellpadding="5">
				<h:outputText value="To: " />
				
				<p:selectOneMenu
					value="#{messageRequestBean.shareTo}"
					effect="fade">
					<f:selectItem itemLabel="Select One" itemValue="" />
					<f:selectItems value="#{userControl.users}" var="user" itemLabel="#{user.userId}" itemValue="#{user.id}" />
				</p:selectOneMenu>
			</h:panelGrid>

			<table width="100%">
				<tr>
					<td align="right">
						<p:commandButton
							value="Share" icon="ui-icon-plus"
							update=":#{p:component('messageForm')}"
							actionListener="#{messageRequestBean.shareMessage}"
							onclick="PF('shareMessage').hide();" />
					</td>
				</tr>
			</table>
		</p:dialog>
	</h:form>
	
	<h:form id="editMessageForm">
		<p:dialog id="editMessageDialog" header="Update Profile"
			widgetVar="editMessage">
			<h:panelGrid id="editMessagePanel" columns="2" cellpadding="5">
				<h:outputText value="Name: " />
				<h:outputText value="#{messageRequestBean.editMessage.name}" />
				<h:outputText value="Description: " />
				<h:outputText value="#{messageRequestBean.editMessage.description}" />

				<h:outputText value="Update Profile: " />
				<p:fileUpload
						fileUploadListener="#{messageRequestBean.updateProfile}"
						mode="advanced"
						auto="true" sizeLimit="10000000" allowTypes="/(\.|\/)(xml)$/" />
						
				<h:outputText value="Update Constraints: " />
				<p:fileUpload
						fileUploadListener="#{messageRequestBean.updateConstraints}"
						mode="advanced"
						auto="true" sizeLimit="10000000" allowTypes="/(\.|\/)(xml)$/" />
				
				<h:outputText value="Update ValueSet: " />
				<p:fileUpload
						fileUploadListener="#{messageRequestBean.updateValueSet}"
						mode="advanced"
						auto="true" sizeLimit="10000000" allowTypes="/(\.|\/)(xml)$/" />
			</h:panelGrid>

			<table width="100%">
				<tr>
					<td align="right"><p:commandButton value="Apply"
							icon="ui-icon-pencil" update=":#{p:component('messageForm')}"
							actionListener="#{messageRequestBean.profileUpdateMessage()}"
							onclick="PF('editMessage').hide();" /></td>
				</tr>
			</table>
		</p:dialog>
	</h:form>
	
</composite:implementation>

</html>