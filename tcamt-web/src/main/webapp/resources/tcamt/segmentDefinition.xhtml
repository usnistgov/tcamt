<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:tcamt="http://java.sun.com/jsf/composite/tcamt">

<composite:interface>
	<composite:attribute name="bean" />
	<composite:attribute name="instancePanelCode" />
	<composite:attribute name="mdPanelCode" />
	<composite:attribute name="sdPanelCode" />
	<composite:attribute name="vcPanelCode" />
</composite:interface>

<composite:implementation>
	<p:dataTable var="instanceSegment"
		value="#{cc.attrs.bean.instanceSegments}"
		rowIndexVar="rowIndex"
		selection="#{cc.attrs.bean.selectedInstanceSegment}"
		selectionMode="single" rowKey="#{instanceSegment.path}">
		<p:ajax event="rowSelect" update="#{cc.attrs.sdPanelCode}" />
		<p:column headerText="List of Instance Segments">
			<h:outputText value="#{instanceSegment.path}" />
		</p:column>
		<p:column headerText="Action">
			<p:commandButton value="Del"
				actionListener="#{cc.attrs.bean.delInstanceSegment}"
				update="#{cc.attrs.sdPanelCode} #{cc.attrs.mdPanelCode}" icon="ui-icon-close"
				title="Del">
				<f:attribute name="rowIndex" value="#{rowIndex}" />
			</p:commandButton>
		</p:column>
	</p:dataTable>
	<p:treeTable
		rendered="#{cc.attrs.bean.selectedInstanceSegment.segmentTreeNode != null}"
		value="#{cc.attrs.bean.selectedInstanceSegment.segmentTreeNode}"
		var="model" resizableColumns="true"
		rowStyleClass="#{model.occurrence lt 0 or model.occurrence == 0? 'zeroOccurRow' : (model.node.usage == 'X' ? 'xUsageRow' : (model.node.usage == 'O' ? 'oUsageRow' : (model.node.usage == 'RE' ? 'reUsageRow' : (model.node.usage == 'R' ? 'rUsageRow' : 'normalRow' ) ) ) )}">
		<p:column headerText="Location" style="width:15%;">
			<h:outputText value="#{model.iPath}" />
		</p:column>
		<p:column headerText="Name" style="width:20%;">
			<h:outputText value="#{model.name}" />
		</p:column>
		<p:column headerText="DT" style="width:8%; text-align: center;">
			<h:outputText value="#{model.node.datatype.name}" />
		</p:column>
		<p:column headerText="Usage" style="width:7%; text-align: center;">
			<h:outputText value="#{model.node.usage}" />
		</p:column>
		<p:column headerText="Cardinality"
			style="width:8%; text-align: center;">
			<h:outputText
				rendered="#{model.node.getClass().getSimpleName() == 'Field'}"
				value="[#{model.node.min} ~ " />
			<h:outputText
				rendered="#{model.node.getClass().getSimpleName() == 'Field'}"
				value="#{model.node.max}]" />
		</p:column>
		<p:column headerText="Occur." style="width:8%; text-align: center;">
			<p:spinner rendered="#{model.isFirstField()}" value="#{model.occurrence}" size="1" min="0">
                <p:ajax listener="#{cc.attrs.bean.updateInstanceFieldOccur(model)}"
					update="#{cc.attrs.sdPanelCode}" />
            </p:spinner>
		</p:column>
		<p:column headerText="Length" style="width:8%; text-align: center;">
			<h:outputText rendered="#{model.isLeafNode()}"
				value="[#{model.node.minLength} ~ " />
			<h:outputText rendered="#{model.isLeafNode()}"
				value="#{model.node.maxLength}]" />
		</p:column>
		<p:column headerText="Test Data" style="width:8%; text-align: center;">
			<p:inputText value="#{model.data}" style="width:90%;"
				rendered="#{model.isLeafNode() and model.occurrence > 0}">
				<p:ajax event="blur"
					listener="#{cc.attrs.bean.updateInstanceData(model)}"
					update="#{cc.attrs.vcPanelCode} #{cc.attrs.mdPanelCode}" />
			</p:inputText>
		</p:column>
		<p:column headerText="Type" style="width:8%; text-align: center;">
			<h:outputText value="#{model.type.value}"
				rendered="#{model.isLeafNode() and model.type.value == 'Profile Fixed'}" />
			<p:selectOneMenu value="#{model.type}" effect="fade"
				style="width:100%;"
				rendered="#{model.isLeafNode() and model.occurrence > 0 and model.type.value != 'Profile Fixed'}">
				<f:selectItem itemLabel="Select One" itemValue="" />
				<f:selectItem itemLabel="Indifferent" itemValue="Indifferent" />
				<f:selectItem itemLabel="Content Indifferent" itemValue="ContentIndifferent" />
				<f:selectItem itemLabel="Configurable" itemValue="Configurable" />
				<f:selectItem itemLabel="System Generated" itemValue="SystemGenerated" />
				<f:selectItem itemLabel="Test Case Proper" itemValue="TestCaseProper" />
				<f:selectItem itemLabel="Not-Valued" itemValue="NotValued" />
				<f:selectItem itemLabel="Test Case Fixed" itemValue="TestCaseFixed" />
				<f:selectItem itemLabel="Test Case Fixed - List" itemValue="TestCaseFixedList" />
				<f:selectItem itemLabel="Test Case Fixed - Length" itemValue="TestCaseFixedLength" />
				<p:ajax event="change"
					listener="#{cc.attrs.bean.createValidationContext(model)}"
					update="#{cc.attrs.vcPanelCode} #{cc.attrs.mdPanelCode}" />
			</p:selectOneMenu>
		</p:column>
		<p:column headerText="Value Set"
			style="width:10%; text-align: center;">
			<p:commandButton icon="ui-icon-circle-zoomin" process="@this"
				immediate="true" rendered="#{model.node.codeTable != null}"
				value="#{model.node.codeTable.name}">
			</p:commandButton>
		</p:column>
	</p:treeTable>

</composite:implementation>

</html>