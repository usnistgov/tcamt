<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:tcamt="http://java.sun.com/jsf/composite/tcamt">

<composite:interface>
</composite:interface>

<composite:implementation>
	<h:form id="testCaseForm">
		<p:accordionPanel widgetVar="TestCaseLibPanel">
			<p:tab title="Test Case DashBoard">
				<table width="100%">
					<tr>
						<td align="right">
							<p:commandButton
								value="Create New Test Case" icon="ui-icon-plus"
								actionListener="#{testCaseRequestBean.createTestCase}"
								update=":#{p:component('createTestCaseForm')}"
								oncomplete="PF('createTestCase').show();" />
						</td>
					</tr>
				</table>
				
				<p:dataTable id="testCaseList" var="testCase"
					value="#{testCaseRequestBean.testCases}">
					<p:column headerText="Type">
						<h:outputText value="#{testCase.type}" />
					</p:column>
					
					<p:column headerText="Name">
						<h:outputText value="#{testCase.name}" />
					</p:column>

					<p:column headerText="Description">
						<h:outputText value="#{testCase.description}" />
					</p:column>
					
					<p:column headerText="Test Scenario">
						<h:outputText value="#{testCase.testScenario}" />
					</p:column>
					
					<p:column headerText="Sequence Diagram" style="text-align: center;">
						<p:graphicImage value="#{testCaseRequestBean.loadUMLD(testCase)}" cache="false" >
							 <f:param name="code" value="#{testCase.umld}" />
						</p:graphicImage>
					</p:column>
					<p:column headerText="Version">
						<h:outputText value="#{testCase.version}" />
					</p:column>

					<p:column headerText="Action">
						<p:commandButton value="Edit" icon="ui-icon-pencil"
							update=":#{p:component('editTestCaseForm')}"
							actionListener="#{testCaseRequestBean.selectEditTestCase}"
							oncomplete="PF('editTestCase').show();">
							<f:attribute name="testCase" value="#{testCase}" />
						</p:commandButton>
						
						<p:commandButton value="Test Case Story" icon="ui-icon-pencil"
							update=":#{p:component('editTestCaseStoryForm')}"
							actionListener="#{testCaseRequestBean.selectEditTestCase}"
							oncomplete="PF('editTestCaseStory').show();">
							<f:attribute name="testCase" value="#{testCase}" />
						</p:commandButton>
						
						<p:commandButton value="Export TestCase Resource Bundle as ZIP" ajax="false"
							actionListener="#{testCaseRequestBean.downloadResourceBundleForTestCase(testCase)}" icon="ui-icon-disk">
							<p:fileDownload value="#{testCaseRequestBean.zipResourceBundleFile}" />
						</p:commandButton>
						
						<p:commandButton value="Cloning"
							actionListener="#{testCaseRequestBean.cloneTestCase}"
							update=":#{p:component('testCaseForm')}" icon="ui-icon-plus"
							title="Cloning">
							<f:attribute name="testCase" value="#{testCase}" />
						</p:commandButton>
						
 						<p:commandButton
									value="Sharing" icon="ui-icon-transfer-e-w"
									update=":#{p:component('shareTestCaseForm')}"
									actionListener="#{testCaseRequestBean.selectEditTestCase}"
									oncomplete="PF('shareTestCase').show();" >
									<f:attribute name="testCase" value="#{testCase}" />
						</p:commandButton>
						
						<p:commandButton value="Del" update=":#{p:component('testCaseDelConfirmPanel')}" icon="ui-icon-close"
											actionListener="#{testCaseRequestBean.checkTestCaseToDelete}" onclick="PF('testCaseDelConfirmDialog').show()" title="Del">
							<f:attribute name="testCase" value="#{testCase}" />
						</p:commandButton>
					</p:column>
				</p:dataTable>
			</p:tab>
		</p:accordionPanel>
		<p:confirmDialog id="testCaseDelConfirm" message="Do you want to delete?" header="Deleting TestCase" severity="alert" widgetVar="testCaseDelConfirmDialog">
			<h:panelGrid id="testCaseDelConfirmPanel" columns="2" cellpadding="5">
				<p:commandButton rendered="#{testCaseRequestBean.canDelete}" value="Yes" actionListener="#{testCaseRequestBean.delTestCase}" update=":#{p:component('testCaseForm')}" oncomplete="PF('testCaseDelConfirmDialog').hide()"/>
				<p:commandButton rendered="#{testCaseRequestBean.canDelete}" value="No" onclick="PF('testCaseDelConfirmDialog').hide();" type="button" />
				<h:outputText rendered="#{!testCaseRequestBean.canDelete}" value="This TestCase cannot be deleted becasue it is used by TestPlan(s)." />
				<p:commandButton rendered="#{!testCaseRequestBean.canDelete}" value="OK" onclick="PF('testCaseDelConfirmDialog').hide();" type="button" />
			</h:panelGrid>
		</p:confirmDialog>
	</h:form>
	
	<h:form id="createTestCaseForm">
		<p:dialog id="createTestCaseDialog" header="Create TestCase" widgetVar="createTestCase">
			<h:panelGrid id="creatTestCasePanel" columns="3" cellpadding="5">
				<h:outputText value="Test Case Type: " />
				<p:selectOneMenu value="#{testCaseRequestBean.newTestCase.type}" effect="fade">
					<f:selectItem itemLabel="Data Instance Test Case" itemValue="Data Instance Test Case" />
					<f:selectItem itemLabel="Isolated Test Case" itemValue="Isolated Test Case" />
					<p:ajax update=":#{p:component('creatTestCasePanel')} :#{p:component('ListTestStepsOfTestCase1')}" />
				</p:selectOneMenu>
				<h:outputText value=" " />
				
				
				<h:outputText value="Name: " />
				<p:inputText value="#{testCaseRequestBean.newTestCase.name}"/>
				<h:outputText value=" " />

				<h:outputText value="Description: " />
				<p:inputText value="#{testCaseRequestBean.newTestCase.description}"/>
				<h:outputText value=" " />
				
				
				<h:outputText value="Test Scenario: " />
				<p:inputText value="#{testCaseRequestBean.newTestCase.testScenario}"/>
				<h:outputText value=" " />
				
				<h:outputText value="From Test Step List" />
				<p:selectOneMenu rendered="#{testCaseRequestBean.newTestCase.type != 'Isolated Test Case'}" value="#{testCaseRequestBean.newTestStepId}">
					<f:selectItem itemLabel="Select One" itemValue="" />
					<f:selectItems value="#{testStepRequestBean.testSteps}" var="teststep" itemLabel="#{teststep.name}" itemValue="#{teststep.id}" />
				</p:selectOneMenu>
				<p:selectOneMenu rendered="#{testCaseRequestBean.newTestCase.type == 'Isolated Test Case'}" value="#{testCaseRequestBean.newTestStepId}">
					<f:selectItem itemLabel="Select One" itemValue="" />
					<f:selectItems value="#{testStepRequestBean.testStepsForIsolatedTestCase}" var="teststep" itemLabel="#{teststep.name}" itemValue="#{teststep.id}" />
				</p:selectOneMenu>
				<p:commandButton value="Add Test Step" update=":#{p:component('ListTestStepsOfTestCase1')} :#{p:component('sutSelector')}" actionListener="#{testCaseRequestBean.addTestStep}" styleClass="ui-priority-primary" />
				
				<h:outputText value="From Test Steps Group" />
				<p:selectOneMenu id="selectOneTransaction1" value="#{testCaseRequestBean.newTransactionId}">
					<f:selectItem itemLabel="Select One" itemValue="" />
					<f:selectItems value="#{transactionRequestBean.transactions}" var="transaction" itemLabel="#{transaction.name}" itemValue="#{transaction.id}" />
				</p:selectOneMenu>
				<p:commandButton value="Add Test Step Group" update=":#{p:component('ListTestStepsOfTestCase1')} :#{p:component('selectOneTransaction1')} :#{p:component('sutSelector')}" actionListener="#{testCaseRequestBean.addTransaction}" styleClass="ui-priority-primary" />
				
				<h:outputText rendered="#{testCaseRequestBean.newTestCase.type == 'Isolated Test Case'}" value="SUT Actor: " />
				<p:selectOneMenu id="sutSelector" rendered="#{testCaseRequestBean.newTestCase.type == 'Isolated Test Case'}" value="#{testCaseRequestBean.newTestCase.sutActorId}">
					<f:selectItem itemLabel="Select One" itemValue="" />
					<f:selectItems value="#{testCaseRequestBean.newTestCase.listActors}" var="actor" itemLabel="#{actor.name}" itemValue="#{actor.id}" />
				</p:selectOneMenu>
				<h:outputText value=" " />
			</h:panelGrid>

			<p:dataTable id="ListTestStepsOfTestCase1" var="tsid"
				rowIndexVar="rowIndex"
				value="#{testCaseRequestBean.newTestCase.testSteps}">
				<p:column headerText="#">
        			#{rowIndex+1}
    			</p:column>
				<p:column headerText="TestStep Name">
					<h:outputText value="#{testCaseRequestBean.findTestStep(tsid).name}" />
				</p:column>

				<p:column headerText="Sending Actor" rendered="#{testCaseRequestBean.newTestCase.type == 'Isolated Test Case'}">
					<h:outputText value="#{testCaseRequestBean.findTestStep(tsid).interaction.sActor.name}" />
				</p:column>

				<p:column headerText="Message">
					<h:outputText value="#{testCaseRequestBean.findTestStep(tsid).interaction.message.name}" />
				</p:column>

				<p:column headerText="Receiving Actor" rendered="#{testCaseRequestBean.newTestCase.type == 'Isolated Test Case'}">
					<h:outputText value="#{testCaseRequestBean.findTestStep(tsid).interaction.rActor.name}" />
				</p:column>

				
				<p:column headerText="Manual Action">
					<h:outputText rendered="#{testCaseRequestBean.findTestStep(tsid).type=='Manual'}" value="(#{testCaseRequestBean.findTestStep(tsid).targetActor.name})#{testCaseRequestBean.findTestStep(tsid).description}" />
				</p:column>
				
				<p:column headerText="Test Step Type" rendered="#{testCaseRequestBean.newTestCase.type == 'Isolated Test Case'}">
					<h:outputText value="#{testCaseRequestBean.findTransactionName(rowIndex)}" />
				</p:column>
				
				
				<p:column headerText="Action">
					<p:commandButton icon="ui-icon-arrow-1-n"
						update=":#{p:component('ListTestStepsOfTestCase1')}"
						actionListener="#{testCaseRequestBean.moveUpTestStep}"
						styleClass="ui-priority-primary">
						<f:attribute name="num" value="#{rowIndex}" />
					</p:commandButton>
					<p:commandButton icon="ui-icon-arrow-1-s"
						update=":#{p:component('ListTestStepsOfTestCase1')}"
						actionListener="#{testCaseRequestBean.moveDownTestStep}"
						styleClass="ui-priority-primary">
						<f:attribute name="num" value="#{rowIndex}" />
					</p:commandButton>
					<p:commandButton icon="ui-icon-close"
						update=":#{p:component('ListTestStepsOfTestCase1')}"
						actionListener="#{testCaseRequestBean.delTestStep}"
						styleClass="ui-priority-primary">
						<f:attribute name="num" value="#{rowIndex}" />
					</p:commandButton>
				</p:column>
			</p:dataTable>

			<table width="100%">
				<tr>
					<td align="right"><p:commandButton value="Create"
							icon="ui-icon-plus" update=":#{p:component('testCaseList')}"
							actionListener="#{testCaseRequestBean.addTestCase}"
							onclick="PF('createTestCase').hide();" /></td>
				</tr>
			</table>
		</p:dialog>
	</h:form>
	
	<h:form id="shareTestCaseForm">
		<p:dialog id="shareTestCaseDialog" header="Share TestCase"
			widgetVar="shareTestCase">
			<h:panelGrid id="shareTestCasePanel" columns="2" cellpadding="5">
				<h:outputText value="To: " />
				
				<p:selectOneMenu
					value="#{testCaseRequestBean.shareTo}"
					effect="fade">
					<f:selectItem itemLabel="Select One" itemValue="" />
					<f:selectItems value="#{userControl.users}" var="user" itemLabel="#{user}" itemValue="#{user}" />
				</p:selectOneMenu>
			</h:panelGrid>

			<table width="100%">
				<tr>
					<td align="right">
						<p:commandButton
							value="Share" icon="ui-icon-plus"
							update=":#{p:component('testCaseList')}"
							actionListener="#{testCaseRequestBean.shareTestCase}"
							onclick="PF('shareTestCase').hide();" />
					</td>
				</tr>
			</table>
		</p:dialog>
	</h:form>
	
	<h:form id="editTestCaseForm">	
		<p:dialog id="editTestCaseDialog" header="Edit TestCase"
			widgetVar="editTestCase">
			<h:panelGrid id="editTestCasePanel" columns="3" cellpadding="5">
				<h:outputText value="Test Case Type: " />
				<h:outputText value="#{testCaseRequestBean.editTestCase.type}" />
				<h:outputText value=" " />
				
				<h:outputText value="Name: " />
				<p:inputText value="#{testCaseRequestBean.editTestCase.name}"/>
				<h:outputText value=" " />

				<h:outputText value="Description: " />
				<p:inputText value="#{testCaseRequestBean.editTestCase.description}"/>
				<h:outputText value=" " />

				<h:outputText value="Test Scenario: " />
				<p:inputText value="#{testCaseRequestBean.editTestCase.testScenario}"/>
				<h:outputText value=" " />
				
				<h:outputText value="From Test Step List" />
				<p:selectOneMenu rendered="#{testCaseRequestBean.editTestCase.type != 'Isolated Test Case'}" value="#{testCaseRequestBean.newTestStepIdForEdit}" effect="fade">
					<f:selectItem itemLabel="Select One" itemValue="" />
					<f:selectItems value="#{testStepRequestBean.testSteps}" var="testStep" itemLabel="#{testStep.name}" itemValue="#{testStep.id}" />
				</p:selectOneMenu>
				<p:selectOneMenu rendered="#{testCaseRequestBean.editTestCase.type == 'Isolated Test Case'}" value="#{testCaseRequestBean.newTestStepIdForEdit}" effect="fade">
					<f:selectItem itemLabel="Select One" itemValue="" />
					<f:selectItems value="#{testStepRequestBean.testStepsForIsolatedTestCase}" var="testStep" itemLabel="#{testStep.name}" itemValue="#{testStep.id}" />
				</p:selectOneMenu>
				<p:commandButton value="Add TestStep"
					update=":#{p:component('ListTestStepsOfTestCase2')} :#{p:component('sutSelectorForEdit')}"
					actionListener="#{testCaseRequestBean.addTestStepForEdit}"
					styleClass="ui-priority-primary" />
				
				<h:outputText value="From Test Steps Group" />
				<p:selectOneMenu id="selectOneTransaction2" value="#{testCaseRequestBean.newTransactionIdForEdit}" effect="fade">
					<f:selectItem itemLabel="Select One" itemValue="" />
					<f:selectItems value="#{transactionRequestBean.transactions}" var="transaction" itemLabel="#{transaction.name}" itemValue="#{transaction.id}" />
				</p:selectOneMenu>
				<p:commandButton value="Add TestStepGroup"
					update=":#{p:component('ListTestStepsOfTestCase2')} :#{p:component('selectOneTransaction2')} :#{p:component('sutSelectorForEdit')}"
					actionListener="#{testCaseRequestBean.addTransactionForEdit}"
					styleClass="ui-priority-primary" />
				
				<h:outputText rendered="#{testCaseRequestBean.editTestCase.type == 'Isolated Test Case'}" value="SUT Actor: " />
				<p:selectOneMenu id="sutSelectorForEdit" rendered="#{testCaseRequestBean.editTestCase.type == 'Isolated Test Case'}" value="#{testCaseRequestBean.editTestCase.sutActorId}">
					<f:selectItem itemLabel="Select One" itemValue="" />
					<f:selectItems value="#{testCaseRequestBean.editTestCase.listActors}" var="actor" itemLabel="#{actor.name}" itemValue="#{actor.id}" />
				</p:selectOneMenu>
				<h:outputText value=" " />
			</h:panelGrid>
			<p:dataTable id="ListTestStepsOfTestCase2" var="tsid"
				rowIndexVar="rowIndex"
				value="#{testCaseRequestBean.editTestCase.testSteps}">
				<p:column headerText="#">
        			#{rowIndex+1}
    			</p:column>
				<p:column headerText="TestStep Name">
					<h:outputText value="#{testCaseRequestBean.findTestStep(tsid).name}" />
				</p:column>

				<p:column headerText="Sending Actor" rendered="#{testCaseRequestBean.editTestCase.type == 'Isolated Test Case'}">
					<h:outputText value="#{testCaseRequestBean.findTestStep(tsid).interaction.sActor.name}" />
				</p:column>

				<p:column headerText="Message">
					<h:outputText value="#{testCaseRequestBean.findTestStep(tsid).interaction.message.name}" />
				</p:column>

				<p:column headerText="Receiving Actor" rendered="#{testCaseRequestBean.editTestCase.type == 'Isolated Test Case'}">
					<h:outputText value="#{testCaseRequestBean.findTestStep(tsid).interaction.rActor.name}" />
				</p:column>
				
				<p:column headerText="Manual Action">
					<h:outputText rendered="#{testCaseRequestBean.findTestStep(tsid).type=='Manual'}" value="(#{testCaseRequestBean.findTestStep(tsid).targetActor.name})#{testCaseRequestBean.findTestStep(tsid).description}" />
				</p:column>
				
				<p:column headerText="Test Step Type" rendered="#{testCaseRequestBean.editTestCase.type == 'Isolated Test Case'}">
					<h:outputText value="#{testCaseRequestBean.findTransactionNameForEdit(rowIndex)}" />
				</p:column>

				<p:column headerText="Action">
					<p:commandButton icon="ui-icon-arrow-1-n"
						update=":#{p:component('ListTestStepsOfTestCase2')}"
						actionListener="#{testCaseRequestBean.moveUpTestStepForEdit}"
						styleClass="ui-priority-primary">
						<f:attribute name="num" value="#{rowIndex}" />
					</p:commandButton>
					<p:commandButton icon="ui-icon-arrow-1-s"
						update=":#{p:component('ListTestStepsOfTestCase2')}"
						actionListener="#{testCaseRequestBean.moveDownTestStepForEdit}"
						styleClass="ui-priority-primary">
						<f:attribute name="num" value="#{rowIndex}" />
					</p:commandButton>
					<p:commandButton icon="ui-icon-close"
						update=":#{p:component('ListTestStepsOfTestCase2')}"
						actionListener="#{testCaseRequestBean.delTestStepForEdit}"
						styleClass="ui-priority-primary">
						<f:attribute name="num" value="#{rowIndex}" />
					</p:commandButton>
				</p:column>
			</p:dataTable>

			<table width="100%">
				<tr>
					<td align="right"><p:commandButton value="Apply"
							icon="ui-icon-plus" update=":#{p:component('testCaseList')}"
							actionListener="#{testCaseRequestBean.updateTestCase}"
							onclick="PF('editTestCase').hide();" /></td>
				</tr>
			</table>
		</p:dialog>
	</h:form>
	
	<h:form id="editTestCaseStoryForm">
		<p:dialog id="editTestCaseStoryDialog" header="Edit Test Case Story" widgetVar="editTestCaseStory" width="90%" height="700px" dynamic="true">
			<table width="100%">
				<tr>
					<td align="right"><p:commandButton value="Save"
							icon="ui-icon-plus" update=":#{p:component('testCaseList')}"
							actionListener="#{testCaseRequestBean.saveTestCase}"
							onclick="PF('editTestCaseStory').hide();" /></td>
				</tr>
			</table>
			<p:scrollPanel style="width:100%;height:99%" mode="native">
				<p:fieldset legend="Test Case Story" toggleable="true">
					<p:panel header="Test Case Story Description" toggleable="true" toggleSpeed="500" widgetVar="testCaseStoryDescPanel" style="margin-bottom:20px">
						<p:editor widgetVar="testCaseStoryDescWidget" height="100" value="#{testCaseRequestBean.editTestCase.testCaseStory.description}" />
					</p:panel>
					<p:panel id="testCaseStoryComments" header="Comments" toggleable="true" toggleSpeed="500" widgetVar="testCaseStoryCommentsPanel" style="margin-bottom:20px">
						<p:editor widgetVar="testCaseStoryCommentsWidget" height="100" value="#{testCaseRequestBean.editTestCase.testCaseStory.comments}" />
					</p:panel>
					<p:panel id="testCaseStoryPreCondition" header="Pre-Condition" toggleable="true" toggleSpeed="500" widgetVar="testCaseStoryPreConditionPanel" style="margin-bottom:20px">
						<p:editor widgetVar="testCaseStoryPreConditionWidget" height="100" value="#{testCaseRequestBean.editTestCase.testCaseStory.preCondition}" />
					</p:panel>
					<p:panel id="testCaseStoryPostCondition" header="Post-Condition" toggleable="true" toggleSpeed="500" widgetVar="testCaseStoryPostConditionPanel" style="margin-bottom:20px">
						<p:editor widgetVar="testCaseStoryPostConditionWidget" height="100" value="#{testCaseRequestBean.editTestCase.testCaseStory.postCondition}" />
					</p:panel>
					<p:panel id="testCaseStoryTestObjectives" header="Test Objectives" toggleable="true" toggleSpeed="500" widgetVar="testCaseStoryTestObjectivesPanel"	style="margin-bottom:20px">
						<p:editor widgetVar="testCaseStoryTestObjectivesWidget" height="100" value="#{testCaseRequestBean.editTestCase.testCaseStory.testObjectives}" />
					</p:panel>
					<p:panel id="testCaseStoryNotes" header="Notes to Testers" toggleable="true" toggleSpeed="500" widgetVar="testCaseStoryNotesPanel" style="margin-bottom:20px">
						<p:editor widgetVar="testCaseStoryNotesWidget" height="100" value="#{testCaseRequestBean.editTestCase.testCaseStory.notes}" />
					</p:panel>
				</p:fieldset>
			</p:scrollPanel>
		</p:dialog>
	</h:form>
</composite:implementation>

</html>