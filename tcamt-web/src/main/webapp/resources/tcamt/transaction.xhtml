<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:tcamt="http://java.sun.com/jsf/composite/tcamt">

<composite:interface>
</composite:interface>

<composite:implementation>
	<h:form id="transactionForm">
		<p:accordionPanel widgetVar="TransactionLibPanel">
			<p:tab title="Transaction DashBoard">
				<table width="100%">
					<tr>
						<td align="right">
							<p:commandButton
								value="Create New Transaction" icon="ui-icon-plus"
								actionListener="#{transactionRequestBean.createTransaction}"
								update=":#{p:component('createTransactionForm')}"
								oncomplete="PF('createTransaction').show();" />
						</td>
					</tr>
				</table>
				
				<p:dataTable id="transactionList" var="transaction"
					value="#{transactionRequestBean.transactions}">
					<p:column headerText="Name">
						<h:outputText value="#{transaction.name}" />
					</p:column>

					<p:column headerText="Description">
						<h:outputText value="#{transaction.description}" />
					</p:column>
					<p:column headerText="Sequence Diagram" style="text-align: center;">
						<p:graphicImage value="#{transactionRequestBean.loadUMLD(transaction)}" cache="false" >
							 <f:param name="code" value="#{transaction.umld}" />
						</p:graphicImage>
					</p:column>
					<p:column headerText="Version">
						<h:outputText value="#{transaction.version}" />
					</p:column>

					<p:column headerText="Action">
						<p:commandButton value="Edit" icon="ui-icon-pencil"
							update=":#{p:component('editTransactionForm')}"
							actionListener="#{transactionRequestBean.selectEditTransaction}"
							oncomplete="PF('editTransaction').show();">
							<f:attribute name="transaction" value="#{transaction}" />
						</p:commandButton>
						
						<p:commandButton value="Cloning"
							actionListener="#{transactionRequestBean.cloneTransaction}"
							update=":#{p:component('transactionForm')}" icon="ui-icon-plus"
							title="Cloning">
							<f:attribute name="transaction" value="#{transaction}" />
						</p:commandButton>
						
 						<p:commandButton
									value="Sharing" icon="ui-icon-transfer-e-w"
									update=":#{p:component('shareTransactionForm')}"
									actionListener="#{transactionRequestBean.selectEditTransaction}"
									oncomplete="PF('shareTransaction').show();" >
									<f:attribute name="transaction" value="#{transaction}" />
						</p:commandButton>

						<p:commandButton value="Del"
							actionListener="#{transactionRequestBean.delTransaction}"
							update=":#{p:component('transactionForm')}" icon="ui-icon-close"
							title="Del">
							<f:attribute name="transaction" value="#{transaction}" />
						</p:commandButton>
					</p:column>
				</p:dataTable>
			</p:tab>

		</p:accordionPanel>
	</h:form>
	
	<h:form id="createTransactionForm">
		<p:dialog id="createTransactionDialog" header="Create Transaction"
			widgetVar="createTransaction">
			<h:panelGrid id="creatTransactionPanel" columns="2" cellpadding="5">

				<h:outputText value="Name: " />
				<p:inputText value="#{transactionRequestBean.newTransaction.name}"/>
				
				<h:outputText value="Description: " />
				<p:inputText value="#{transactionRequestBean.newTransaction.description}"/>

				<p:selectOneMenu id="selectOneTestStep1" value="#{transactionRequestBean.newTestStepId}">
					<f:selectItem itemLabel="Select One" itemValue="" />
					<f:selectItems value="#{testStepRequestBean.testSteps}" var="teststep" itemLabel="#{teststep.name}"	itemValue="#{teststep.id}" />
				</p:selectOneMenu>
				<p:commandButton value="Add Test Step"
					update=":#{p:component('ListTestStepsOfTransaction1')} :#{p:component('selectOneTestStep1')} "
					actionListener="#{transactionRequestBean.addTestStep}"
					styleClass="ui-priority-primary" />
				
			</h:panelGrid>
			<p:dataTable id="ListTestStepsOfTransaction1" var="tsid"
				rowIndexVar="rowIndex"
				value="#{transactionRequestBean.newTransaction.testSteps}">
				<p:column headerText="#">
        			#{rowIndex+1}
    			</p:column>
				<p:column headerText="TestStep Name">
					<h:outputText value="#{transactionRequestBean.findTestStep(tsid).name}" />
				</p:column>
				
				<p:column headerText="Interaction Name">
					<h:outputText value="#{transactionRequestBean.findTestStep(tsid).interaction.name}" />
				</p:column>
				
				<p:column headerText="Sending Actor">
					<h:outputText value="#{transactionRequestBean.findTestStep(tsid).interaction.sActor.name}" />
				</p:column>

				<p:column headerText="Message">
					<h:outputText value="#{transactionRequestBean.findTestStep(tsid).interaction.message.name}" />
				</p:column>

				<p:column headerText="Receiving Actor">
					<h:outputText value="#{transactionRequestBean.findTestStep(tsid).interaction.rActor.name}" />
				</p:column>
				
				<p:column headerText="Manual Action">
					<h:outputText rendered="#{transactionRequestBean.findTestStep(tsid).type=='Manual'}" value="(#{transactionRequestBean.findTestStep(tsid).targetActor.name})#{transactionRequestBean.findTestStep(tsid).description}" />
				</p:column>
				
				
				<p:column headerText="Action">
					<p:commandButton icon="ui-icon-arrow-1-n"
						update=":#{p:component('ListTestStepsOfTransaction1')}"
						actionListener="#{transactionRequestBean.moveUpTestStep}"
						styleClass="ui-priority-primary">
						<f:attribute name="num" value="#{rowIndex}" />
					</p:commandButton>
					<p:commandButton icon="ui-icon-arrow-1-s"
						update=":#{p:component('ListTestStepsOfTransaction1')}"
						actionListener="#{transactionRequestBean.moveDownTestStep}"
						styleClass="ui-priority-primary">
						<f:attribute name="num" value="#{rowIndex}" />
					</p:commandButton>
					<p:commandButton icon="ui-icon-close"
						update=":#{p:component('ListTestStepsOfTransaction1')}"
						actionListener="#{transactionRequestBean.delTestStep}"
						styleClass="ui-priority-primary">
						<f:attribute name="num" value="#{rowIndex}" />
					</p:commandButton>
				</p:column>
			</p:dataTable>

			<table width="100%">
				<tr>
					<td align="right"><p:commandButton value="Create"
							icon="ui-icon-plus" update=":#{p:component('transactionList')}"
							actionListener="#{transactionRequestBean.addTransaction}"
							onclick="PF('createTransaction').hide();" /></td>
				</tr>
			</table>
		</p:dialog>
	</h:form>
	
	
	<h:form id="shareTransactionForm">
		<p:dialog id="shareTransactionDialog" header="Share TestStep Group"
			widgetVar="shareTransaction">
			<h:panelGrid id="shareTransactionPanel" columns="2" cellpadding="5">
				<h:outputText value="To: " />
				
				<p:selectOneMenu
					value="#{transactionRequestBean.shareTo}"
					effect="fade">
					<f:selectItem itemLabel="Select One" itemValue="" />
					<f:selectItems value="#{userControl.users}" var="user" itemLabel="#{user}" itemValue="#{user}" />
				</p:selectOneMenu>
			</h:panelGrid>

			<table width="100%">
				<tr>
					<td align="right">
						<p:commandButton
							value="Share" icon="ui-icon-plus"
							update=":#{p:component('transactionList')}"
							actionListener="#{transactionRequestBean.shareTransaction}"
							onclick="PF('shareTransaction').hide();" />
					</td>
				</tr>
			</table>
		</p:dialog>
	</h:form>
	
	<h:form id="editTransactionForm">	
		<p:dialog id="editTransactionDialog" header="Edit Transaction"
			widgetVar="editTransaction">
			<h:panelGrid id="editTransactionPanel" columns="2" cellpadding="5">
				<h:outputText value="Name: " />
				<p:inputText value="#{transactionRequestBean.editTransaction.name}"/>

				<h:outputText value="Description: " />
				<p:inputText value="#{transactionRequestBean.editTransaction.description}"/>

				<p:selectOneMenu id="selectOneTestStep2" value="#{transactionRequestBean.newTestStepIdForEdit}" effect="fade">
					<f:selectItem itemLabel="Select One" itemValue="" />
					<f:selectItems value="#{testStepRequestBean.testSteps}" var="testStep" itemLabel="#{testStep.name}" itemValue="#{testStep.id}" />
				</p:selectOneMenu>
				<p:commandButton value="Add TestStep" update=":#{p:component('ListTestStepsOfTransaction2')} :#{p:component('selectOneTestStep2')} " actionListener="#{transactionRequestBean.addTestStepForEdit}" styleClass="ui-priority-primary" />

			</h:panelGrid>
			<p:dataTable id="ListTestStepsOfTransaction2" var="tsid"
				rowIndexVar="rowIndex"
				value="#{transactionRequestBean.editTransaction.testSteps}">
				<p:column headerText="#">
        			#{rowIndex+1}
    			</p:column>
				<p:column headerText="TestStep Name">
					<h:outputText value="#{transactionRequestBean.findTestStep(tsid).name}" />
				</p:column>
				
				<p:column headerText="Interaction Name">
					<h:outputText value="#{transactionRequestBean.findTestStep(tsid).interaction.name}" />
				</p:column>

				<p:column headerText="Sending Actor">
					<h:outputText value="#{transactionRequestBean.findTestStep(tsid).interaction.sActor.name}" />
				</p:column>

				<p:column headerText="Message">
					<h:outputText value="#{transactionRequestBean.findTestStep(tsid).interaction.message.name}" />
				</p:column>

				<p:column headerText="Receiving Actor">
					<h:outputText value="#{transactionRequestBean.findTestStep(tsid).interaction.rActor.name}" />
				</p:column>
				
				<p:column headerText="Manual Action">
					<h:outputText rendered="#{transactionRequestBean.findTestStep(tsid).type=='Manual'}" value="(#{transactionRequestBean.findTestStep(tsid).targetActor.name})#{transactionRequestBean.findTestStep(tsid).description}" />
				</p:column>

				<p:column headerText="Action">
					<p:commandButton icon="ui-icon-arrow-1-n"
						update=":#{p:component('ListTestStepsOfTransaction2')}"
						actionListener="#{transactionRequestBean.moveUpTestStepForEdit}"
						styleClass="ui-priority-primary">
						<f:attribute name="num" value="#{rowIndex}" />
					</p:commandButton>
					<p:commandButton icon="ui-icon-arrow-1-s"
						update=":#{p:component('ListTestStepsOfTransaction2')}"
						actionListener="#{transactionRequestBean.moveDownTestStepForEdit}"
						styleClass="ui-priority-primary">
						<f:attribute name="num" value="#{rowIndex}" />
					</p:commandButton>
					<p:commandButton icon="ui-icon-close"
						update=":#{p:component('ListTestStepsOfTransaction2')}"
						actionListener="#{transactionRequestBean.delTestStepForEdit}"
						styleClass="ui-priority-primary">
						<f:attribute name="num" value="#{rowIndex}" />
					</p:commandButton>
				</p:column>
			</p:dataTable>

			<table width="100%">
				<tr>
					<td align="right"><p:commandButton value="Apply"
							icon="ui-icon-plus" update=":#{p:component('transactionList')}"
							actionListener="#{transactionRequestBean.updateTransaction}"
							onclick="PF('editTransaction').hide();" /></td>
				</tr>
			</table>
		</p:dialog>
	</h:form>
	
</composite:implementation>

</html>